# API Reference - User Management System

## UserDao Class Reference

### Authentication

#### `authenticate(String username, String password)`
```java
User user = UserDao.authenticate("admin", "123");
if (user != null) {
    // Login successful
} else {
    // Login failed
}
```
- **Parameters**: 
  - `username` - User's username (String)
  - `password` - User's password (String)
- **Returns**: User object if credentials match, null otherwise
- **SQL Query**: `SELECT * FROM users WHERE username = ? AND password = ?`

---

### User Retrieval

#### `findByUsername(String username)`
```java
User user = UserDao.findByUsername("manager1");
if (user != null) {
    System.out.println(user.getUsername());
}
```
- **Parameters**: 
  - `username` - Username to search for (String)
- **Returns**: User object if found, null otherwise

#### `findById(long id)`
```java
User user = UserDao.findById(1);
String department = user.getDepartment();
```
- **Parameters**: 
  - `id` - User ID (long)
- **Returns**: User object if found, null otherwise

---

### User Creation

#### `createUser(User user)`
```java
User newManager = new User("manager1", "pass123", "mgr@company.com", "1234567890", UserRole.MANAGER);
newManager.setDepartment("Sales");
newManager.setCreatedBy(adminUserId);
newManager.setCreatedAt(System.currentTimeMillis());

try {
    UserDao.createUser(newManager);
    System.out.println("Manager created with ID: " + newManager.getId());
} catch (IllegalArgumentException e) {
    System.out.println(e.getMessage()); // "Username already exists"
}
```
- **Parameters**: 
  - `user` - User object to create
- **Returns**: User object with ID set
- **Throws**: IllegalArgumentException if username already exists
- **Validates**:
  - Duplicate username check
  - All required fields

---

### User Queries

#### `getAllManagers()`
```java
List<User> managers = UserDao.getAllManagers();
for (User manager : managers) {
    System.out.println(manager.getUsername() + " - " + manager.getDepartment());
}
```
- **Returns**: List of all Manager users (empty list if none)

#### `getAllEmployees()`
```java
List<User> employees = UserDao.getAllEmployees();
System.out.println("Total employees: " + employees.size());
```
- **Returns**: List of all Employee users (empty list if none)

#### `getEmployeesByManager(long managerId)`
```java
List<User> myEmployees = UserDao.getEmployeesByManager(managerId);
for (User emp : myEmployees) {
    System.out.println(emp.getUsername() + " - " + emp.getJobTitle());
}
```
- **Parameters**: 
  - `managerId` - ID of the manager (long)
- **Returns**: List of employees created by this manager (empty list if none)

---

### User Update & Delete

#### `updateUser(User user)`
```java
User user = UserDao.findById(5);
user.setEmail("newemail@company.com");
user.setPhoneNumber("9999999999");
UserDao.updateUser(user);
```
- **Parameters**: 
  - `user` - User object with updated values
- **Note**: Updates password, email, phone, department, and job title

#### `deleteUser(long id)`
```java
UserDao.deleteUser(5);
System.out.println("User deleted");
```
- **Parameters**: 
  - `id` - User ID to delete (long)
- **Warning**: Deletes user from database (cannot be undone without backup)

---

## User Model Class Reference

### Constructor

#### `User()`
```java
User user = new User();
user.setUsername("john");
user.setPassword("secret");
```

#### `User(String username, String password, String email, String phoneNumber, UserRole role)`
```java
User emp = new User("employee1", "emp123", "emp@company.com", "0987654321", UserRole.EMPLOYEE);
emp.setJobTitle("Developer");
```

### Properties & Methods

| Property | Getter | Setter | Type | Notes |
|----------|--------|--------|------|-------|
| id | `getId()` | `setId()` | long | Auto-generated by database |
| username | `getUsername()` | `setUsername()` | String | Must be unique |
| password | `getPassword()` | `setPassword()` | String | Stored in plain text (hash in production) |
| email | `getEmail()` | `setEmail()` | String | Must contain @ |
| phoneNumber | `getPhoneNumber()` | `setPhoneNumber()` | String | No format validation |
| role | `getRole()` | `setRole()` | UserRole | ADMIN, MANAGER, or EMPLOYEE |
| department | `getDepartment()` | `setDepartment()` | String | For managers only |
| jobTitle | `getJobTitle()` | `setJobTitle()` | String | For employees only |
| createdBy | `getCreatedBy()` | `setCreatedBy()` | long | User ID who created this user |
| createdAt | `getCreatedAt()` | `setCreatedAt()` | long | Milliseconds since epoch |

---

## UserRole Enum Reference

### Values

#### `ADMIN`
```java
UserRole role = UserRole.ADMIN;
String display = role.getDisplayName(); // "Admin"
```

#### `MANAGER`
```java
UserRole role = UserRole.MANAGER;
String display = role.getDisplayName(); // "Manager"
```

#### `EMPLOYEE`
```java
UserRole role = UserRole.EMPLOYEE;
String display = role.getDisplayName(); // "Employee"
```

### Methods

#### `getDisplayName()`
```java
UserRole role = UserRole.MANAGER;
System.out.println(role.getDisplayName()); // "Manager"
```
- **Returns**: Display name for UI (String)

#### `fromString(String role)`
```java
UserRole role = UserRole.fromString("ADMIN");
UserRole role2 = UserRole.fromString("admin"); // Case insensitive

try {
    UserRole invalid = UserRole.fromString("INVALID");
} catch (IllegalArgumentException e) {
    System.out.println(e.getMessage()); // "Invalid role: INVALID"
}
```
- **Parameters**: Role name as string (case insensitive)
- **Returns**: UserRole enum value
- **Throws**: IllegalArgumentException if role not found

---

## LoginController API

### Static Methods

#### `getCurrentUser()`
```java
User currentUser = LoginController.getCurrentUser();
if (currentUser != null) {
    System.out.println("Logged in as: " + currentUser.getUsername());
}
```
- **Returns**: Current logged-in User, null if not logged in

#### `setCurrentUser(User user)`
```java
LoginController.setCurrentUser(user);
// Later...
User loggedIn = LoginController.getCurrentUser();
```
- **Parameters**: User object or null to logout

---

## Controller APIs

### AdminDashboardController

#### `setCurrentUser(User user)`
```java
AdminDashboardController controller = new AdminDashboardController();
controller.setCurrentUser(adminUser);
// Welcome label updates automatically
```

### ManagerDashboardController

#### `setCurrentUser(User user)`
```java
ManagerDashboardController controller = new ManagerDashboardController();
controller.setCurrentUser(managerUser);
// Loads employees created by this manager
```

### HomeController

#### `setCurrentUser(User user)`
```java
HomeController controller = new HomeController();
controller.setCurrentUser(employeeUser);
// Employee can now access todo list
```

---

## Database Schema Query Reference

### Create Users Table
```sql
CREATE TABLE IF NOT EXISTS users (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  username TEXT NOT NULL UNIQUE,
  password TEXT NOT NULL,
  email TEXT NOT NULL,
  phone_number TEXT NOT NULL,
  role TEXT NOT NULL,
  department TEXT,
  job_title TEXT,
  created_by INTEGER,
  created_at INTEGER,
  FOREIGN KEY(created_by) REFERENCES users(id)
);
```

### Query All Managers
```sql
SELECT * FROM users WHERE role = 'MANAGER';
```

### Query All Employees
```sql
SELECT * FROM users WHERE role = 'EMPLOYEE';
```

### Query Employees by Manager
```sql
SELECT * FROM users WHERE role = 'EMPLOYEE' AND created_by = ?;
```

### Query by Username
```sql
SELECT * FROM users WHERE username = ?;
```

### Query by ID
```sql
SELECT * FROM users WHERE id = ?;
```

---

## Error Codes & Messages

| Error | Cause | Solution |
|-------|-------|----------|
| "Invalid username or password" | Wrong credentials | Verify credentials |
| "Username already exists: [name]" | Duplicate username | Use different username |
| "Invalid email format" | Email without @/too short | Use valid email |
| "All fields are required" | Empty field in form | Fill all fields |
| "Error loading application" | FXML file not found | Check resource paths |
| "Error: [message]" | Database error | Check database connection |

---

## Usage Examples

### Example 1: Complete Login Flow
```java
// Login
User user = UserDao.authenticate("manager1", "pass123");

if (user != null) {
    // Store in controller
    LoginController.setCurrentUser(user);
    
    // Route to appropriate dashboard based on role
    switch(user.getRole()) {
        case ADMIN:
            loadAdminDashboard(user);
            break;
        case MANAGER:
            loadManagerDashboard(user);
            break;
        case EMPLOYEE:
            loadEmployeeScreen(user);
            break;
    }
} else {
    showError("Invalid credentials");
}
```

### Example 2: Create Manager (Admin)
```java
// Create new manager
User manager = new User(
    "manager2",           // username
    "secure_pass",        // password
    "mgr2@company.com",   // email
    "5555555555",         // phone
    UserRole.MANAGER      // role
);

manager.setDepartment("HR");
manager.setCreatedBy(adminUser.getId());
manager.setCreatedAt(System.currentTimeMillis());

try {
    UserDao.createUser(manager);
    System.out.println("Manager created: " + manager.getId());
    loadManagersTable(); // Refresh UI
} catch (IllegalArgumentException e) {
    showError(e.getMessage());
}
```

### Example 3: Get and Display Employees
```java
// Get all employees for current manager
List<User> employees = UserDao.getEmployeesByManager(managerId);

// Display in table
ObservableList<EmployeeRow> rows = FXCollections.observableArrayList();
for (User emp : employees) {
    rows.add(new EmployeeRow(
        emp.getId(),
        emp.getUsername(),
        emp.getEmail(),
        emp.getPhoneNumber(),
        emp.getJobTitle(),
        formatTimestamp(emp.getCreatedAt())
    ));
}
employeesTable.setItems(rows);
```

### Example 4: Validate User Input
```java
String username = usernameField.getText().trim();
String email = emailField.getText().trim();
String phone = phoneField.getText().trim();

// Validation checks
if (username.isEmpty() || email.isEmpty() || phone.isEmpty()) {
    showError("All fields required");
    return;
}

if (!email.contains("@") || email.length() < 5) {
    showError("Invalid email format");
    return;
}

// Check duplicate
if (UserDao.findByUsername(username) != null) {
    showError("Username already exists");
    return;
}

// All good - create user
User newUser = new User(username, password, email, phone, UserRole.EMPLOYEE);
UserDao.createUser(newUser);
```

---

## Thread Safety Notes

- `LoginController.currentUser` is static and shared - use synchronization in multi-threaded environments
- Database connection from singleton `Database.getInstance()` is thread-safe via SQLite locking

---

## Performance Considerations

- **getAllManagers()** - O(n) where n = all users (consider pagination for large datasets)
- **getEmployeesByManager()** - O(m) where m = users in system (indexed query recommended)
- **createUser()** - O(1) insertion + O(n) duplicate check
- **authenticate()** - O(1) lookup (add index on username for production)

---

**Last Updated**: December 4, 2025  
**Version**: 1.0  
**API Level**: Stable
